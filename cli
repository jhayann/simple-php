<?php
$controllerPath = 'App/Controllers/';
$modelPath = 'App/Models/';
if (isset($argc)) {
    if($argv[1] == "MakeController") 
    {
        createController($argv[2]);
    } else if($argv[1] == "MakeModel") { 
        createModel($argv[2]);
    } else if($argv[1] == "MakeAuth") { 
        authGenerate();
    } else {
        echo "command not found";
    }
}
else {
	echo "argc and argv disabled\n";
}

function createModel($model)
{
    global $modelPath;
    $content = '<?php
namespace App\Models;

Use Simple\Model;
Use function Latitude\QueryBuilder\field;
Use PDO;

class '.$model.' extends Model
{
    /**
     *  This generated '.$model.' model.
     *  Create Something great!
     */
}
';
    $file = fopen("$modelPath$model.php", 'w');
    if(fwrite($file,$content)) {
        echo 'Model created successfully';
    } else {
        echo 'failed to create model';
    }
    fclose($file);
}

function createController($controller)
{
global $controllerPath;
$contentController = '<?php
namespace App\Controllers;

Use Simple\View as view;
Use Simple\Request as r;

class '.$controller.' extends Controller
{
    public function index()
    {
        
    }
}';
    $file = fopen("$controllerPath$controller.php", 'w');
        if(fwrite($file,$contentController)) {
            echo 'Controller created successfully';
        } else {
            echo 'failed to create controller';
        }
        fclose($file);
}

function authGenerate()
{
    $success = true;
   foreach (glob('.\vendor\simplyphp\framework\src\AuthScaffolding\controller\*.php') as $filename)
    {
        $dest = "App/Controllers/Auth/".basename($filename);
        if (!file_exists('App/Controllers/Auth')) {
            mkdir('App/Controllers/Auth', 0777, true);
        }
        $file = fopen($dest, "w");
        copy($filename, $dest);
        fclose($file);
        
    }

    foreach (glob('.\vendor\simplyphp\framework\src\AuthScaffolding\helper\*.php') as $filename)
    {
        $dest = "App/Helper/Auth/".basename($filename);
        if (!file_exists('App/Helper/Auth')) {
            mkdir('App/Helper/Auth', 0777, true);
        }
        $file = fopen($dest, "w");
        copy($filename, $dest);
        fclose($file);
    }
    foreach (glob('.\vendor\simplyphp\framework\src\AuthScaffolding\model\*.php') as $filename)
    {
        $dest = "App/Models/".basename($filename);
        $file = fopen($dest, "w");
        copy($filename, $dest);
        fclose($file);
    } 
    foreach (glob('.\vendor\simplyphp\framework\src\AuthScaffolding\Views\Auth\*.html') as $filename)
    {
        $dest = "App/Views/Auth/".basename($filename);
        if (!file_exists('App/Views/Auth')) {
            mkdir('App/Views/Auth', 0777, true);
        }
        $file = fopen($dest, "w");
        copy($filename, $dest);
        fclose($file);
    }
    foreach (glob('.\vendor\simplyphp\framework\src\AuthScaffolding\Views\layouts\*.html') as $filename)
    {
        $dest = "App/Views/layouts/".basename($filename);
        $file = fopen($dest, "w");
        copy($filename, $dest);
        fclose($file);
    }
    
    $routeFile = '.\vendor\simplyphp\framework\src\AuthScaffolding\routes.simply';
    $file = file_get_contents($routeFile, FILE_USE_INCLUDE_PATH);
    $mainRoute = "./App/Routes.php";
    file_put_contents($mainRoute, PHP_EOL.$file, FILE_APPEND | LOCK_EX);

    if($success!=false){
        echo "Auth scaffolding created successfully"; 
    }
}
